# åˆ†æå¸ˆå›¢é˜Ÿ

## æ¦‚è¿°

åˆ†æå¸ˆå›¢é˜Ÿæ˜¯ TradingAgents æ¡†æ¶çš„æ ¸å¿ƒåˆ†æç»„ä»¶ï¼Œè´Ÿè´£ä»ä¸åŒç»´åº¦å¯¹è‚¡ç¥¨è¿›è¡Œä¸“ä¸šåˆ†æã€‚å›¢é˜Ÿç”±å››ç±»ä¸“ä¸šåˆ†æå¸ˆç»„æˆï¼Œæ¯ä¸ªåˆ†æå¸ˆéƒ½ä¸“æ³¨äºç‰¹å®šçš„åˆ†æé¢†åŸŸï¼Œé€šè¿‡åä½œä¸ºæŠ•èµ„å†³ç­–æä¾›å…¨é¢çš„æ•°æ®æ”¯æŒã€‚

## åˆ†æå¸ˆæ¶æ„

### åŸºç¡€åˆ†æå¸ˆè®¾è®¡

æ‰€æœ‰åˆ†æå¸ˆéƒ½åŸºäºç»Ÿä¸€çš„æ¶æ„è®¾è®¡ï¼Œä½¿ç”¨ç›¸åŒçš„å·¥å…·æ¥å£å’Œæ—¥å¿—ç³»ç»Ÿï¼š

```python
# ç»Ÿä¸€çš„åˆ†æå¸ˆæ¨¡å—æ—¥å¿—è£…é¥°å™¨
from tradingagents.utils.tool_logging import log_analyst_module

# ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ
from tradingagents.utils.logging_init import get_logger
logger = get_logger("default")

@log_analyst_module("analyst_type")
def analyst_node(state):
    # åˆ†æå¸ˆé€»è¾‘å®ç°
    pass
```

### æ™ºèƒ½ä½“çŠ¶æ€ç®¡ç†

åˆ†æå¸ˆé€šè¿‡ `AgentState` è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼š

```python
class AgentState:
    company_of_interest: str      # è‚¡ç¥¨ä»£ç 
    trade_date: str              # äº¤æ˜“æ—¥æœŸ
    fundamentals_report: str     # åŸºæœ¬é¢æŠ¥å‘Š
    market_report: str           # å¸‚åœºåˆ†ææŠ¥å‘Š
    news_report: str             # æ–°é—»åˆ†ææŠ¥å‘Š
    sentiment_report: str        # æƒ…ç»ªåˆ†ææŠ¥å‘Š
    messages: List              # æ¶ˆæ¯å†å²
```

## åˆ†æå¸ˆå›¢é˜Ÿæˆå‘˜

### 1. åŸºæœ¬é¢åˆ†æå¸ˆ (Fundamentals Analyst)

**æ–‡ä»¶ä½ç½®**: `tradingagents/agents/analysts/fundamentals_analyst.py`

**æ ¸å¿ƒèŒè´£**:
- åˆ†æå…¬å¸è´¢åŠ¡æ•°æ®å’ŒåŸºæœ¬é¢æŒ‡æ ‡
- è¯„ä¼°å…¬å¸ä¼°å€¼å’Œè´¢åŠ¡å¥åº·åº¦
- æä¾›åŸºäºè´¢åŠ¡æ•°æ®çš„æŠ•èµ„å»ºè®®

**æŠ€æœ¯ç‰¹æ€§**:
- ä½¿ç”¨ç»Ÿä¸€å·¥å…·æ¶æ„è‡ªåŠ¨è¯†åˆ«è‚¡ç¥¨ç±»å‹
- æ”¯æŒAè‚¡ã€æ¸¯è‚¡ã€ç¾è‚¡çš„åŸºæœ¬é¢åˆ†æ
- æ™ºèƒ½é€‰æ‹©åˆé€‚çš„æ•°æ®æºï¼ˆåœ¨çº¿/ç¦»çº¿æ¨¡å¼ï¼‰

**æ ¸å¿ƒå®ç°**:
```python
def create_fundamentals_analyst(llm, toolkit):
    @log_analyst_module("fundamentals")
    def fundamentals_analyst_node(state):
        ticker = state["company_of_interest"]
        
        # è·å–è‚¡ç¥¨å¸‚åœºä¿¡æ¯
        from tradingagents.utils.stock_utils import StockUtils
        market_info = StockUtils.get_market_info(ticker)
        
        # è·å–å…¬å¸åç§°
        company_name = _get_company_name_for_fundamentals(ticker, market_info)
        
        # é€‰æ‹©åˆé€‚çš„å·¥å…·
        if toolkit.config["online_tools"]:
            tools = [toolkit.get_stock_fundamentals_unified]
        else:
            # ç¦»çº¿æ¨¡å¼å·¥å…·é€‰æ‹©
            tools = [...]
```

**æ”¯æŒçš„æ•°æ®æº**:
- **Aè‚¡**: ç»Ÿä¸€æ¥å£è·å–ä¸­å›½è‚¡ç¥¨ä¿¡æ¯
- **æ¸¯è‚¡**: æ”¹è¿›çš„æ¸¯è‚¡å·¥å…·
- **ç¾è‚¡**: FinnHubã€SimFinç­‰æ•°æ®æº

### 2. å¸‚åœºåˆ†æå¸ˆ (Market Analyst)

**æ–‡ä»¶ä½ç½®**: `tradingagents/agents/analysts/market_analyst.py`

**æ ¸å¿ƒèŒè´£**:
- æŠ€æœ¯æŒ‡æ ‡åˆ†æï¼ˆRSIã€MACDã€å¸ƒæ—å¸¦ç­‰ï¼‰
- ä»·æ ¼è¶‹åŠ¿å’Œå›¾è¡¨æ¨¡å¼è¯†åˆ«
- æ”¯æ’‘é˜»åŠ›ä½åˆ†æ
- äº¤æ˜“ä¿¡å·ç”Ÿæˆ

**åˆ†æç»´åº¦**:
- çŸ­æœŸæŠ€æœ¯æŒ‡æ ‡
- ä¸­é•¿æœŸè¶‹åŠ¿åˆ†æ
- æˆäº¤é‡åˆ†æ
- ä»·æ ¼åŠ¨é‡è¯„ä¼°

### 3. æ–°é—»åˆ†æå¸ˆ (News Analyst)

**æ–‡ä»¶ä½ç½®**: `tradingagents/agents/analysts/news_analyst.py`

**æ ¸å¿ƒèŒè´£**:
- æ–°é—»äº‹ä»¶å½±å“åˆ†æ
- å®è§‚ç»æµæ•°æ®è§£è¯»
- æ”¿ç­–å½±å“è¯„ä¼°
- è¡Œä¸šåŠ¨æ€åˆ†æ

**æ•°æ®æ¥æº**:
- Google News API
- FinnHubæ–°é—»æ•°æ®
- å®æ—¶æ–°é—»æµ
- ç»æµæ•°æ®å‘å¸ƒ

**ç‰¹æ®ŠåŠŸèƒ½**:
- æ–°é—»è¿‡æ»¤å’Œè´¨é‡è¯„ä¼°
- æƒ…æ„Ÿåˆ†æå’Œå½±å“è¯„çº§
- æ—¶æ•ˆæ€§è¯„ä¼°

### 4. ç¤¾äº¤åª’ä½“åˆ†æå¸ˆ (Social Media Analyst)

**æ–‡ä»¶ä½ç½®**: `tradingagents/agents/analysts/social_media_analyst.py`

**æ ¸å¿ƒèŒè´£**:
- ç¤¾äº¤åª’ä½“æƒ…ç»ªåˆ†æ
- æŠ•èµ„è€…æƒ…ç»ªç›‘æµ‹
- èˆ†è®ºè¶‹åŠ¿è¯†åˆ«
- çƒ­ç‚¹è¯é¢˜è¿½è¸ª

**æ•°æ®æ¥æº**:
- Redditè®¨è®ºæ•°æ®
- Twitteræƒ…æ„Ÿæ•°æ®
- é‡‘èè®ºå›è®¨è®º
- ç¤¾äº¤åª’ä½“çƒ­åº¦æŒ‡æ ‡

### 5. ä¸­å›½å¸‚åœºåˆ†æå¸ˆ (China Market Analyst)

**æ–‡ä»¶ä½ç½®**: `tradingagents/agents/analysts/china_market_analyst.py`

**æ ¸å¿ƒèŒè´£**:
- ä¸“é—¨é’ˆå¯¹ä¸­å›½Aè‚¡å¸‚åœºçš„åˆ†æ
- ä¸­å›½ç‰¹è‰²çš„å¸‚åœºå› ç´ åˆ†æ
- æ”¿ç­–ç¯å¢ƒå½±å“è¯„ä¼°
- æœ¬åœŸåŒ–çš„æŠ•èµ„é€»è¾‘

## å·¥å…·é›†æˆ

### ç»Ÿä¸€å·¥å…·æ¶æ„

åˆ†æå¸ˆä½¿ç”¨ç»Ÿä¸€çš„å·¥å…·æ¥å£ï¼Œæ”¯æŒè‡ªåŠ¨è‚¡ç¥¨ç±»å‹è¯†åˆ«ï¼š

```python
# ç»Ÿä¸€åŸºæœ¬é¢åˆ†æå·¥å…·
tools = [toolkit.get_stock_fundamentals_unified]

# å·¥å…·å†…éƒ¨è‡ªåŠ¨è¯†åˆ«è‚¡ç¥¨ç±»å‹å¹¶è°ƒç”¨ç›¸åº”æ•°æ®æº
# - Aè‚¡: ä½¿ç”¨ä¸­å›½è‚¡ç¥¨æ•°æ®æ¥å£
# - æ¸¯è‚¡: ä½¿ç”¨æ¸¯è‚¡ä¸“ç”¨æ¥å£
# - ç¾è‚¡: ä½¿ç”¨FinnHubç­‰å›½é™…æ•°æ®æº
```

### åœ¨çº¿/ç¦»çº¿æ¨¡å¼

**åœ¨çº¿æ¨¡å¼** (`online_tools=True`):
- ä½¿ç”¨å®æ—¶APIæ•°æ®
- æ•°æ®æœ€æ–°ä½†æˆæœ¬è¾ƒé«˜
- é€‚åˆç”Ÿäº§ç¯å¢ƒ

**ç¦»çº¿æ¨¡å¼** (`online_tools=False`):
- ä½¿ç”¨ç¼“å­˜æ•°æ®
- æˆæœ¬ä½ä½†æ•°æ®å¯èƒ½æ»å
- é€‚åˆå¼€å‘å’Œæµ‹è¯•

## è‚¡ç¥¨ç±»å‹æ”¯æŒ

### å¸‚åœºè¯†åˆ«æœºåˆ¶

```python
from tradingagents.utils.stock_utils import StockUtils
market_info = StockUtils.get_market_info(ticker)

# è¿”å›ä¿¡æ¯åŒ…æ‹¬ï¼š
# - is_china: æ˜¯å¦ä¸ºAè‚¡
# - is_hk: æ˜¯å¦ä¸ºæ¸¯è‚¡
# - is_us: æ˜¯å¦ä¸ºç¾è‚¡
# - market_name: å¸‚åœºåç§°
# - currency_name: è´§å¸åç§°
# - currency_symbol: è´§å¸ç¬¦å·
```

### æ”¯æŒçš„å¸‚åœº

1. **ä¸­å›½Aè‚¡**
   - è‚¡ç¥¨ä»£ç æ ¼å¼ï¼š000001, 600000ç­‰
   - è´§å¸å•ä½ï¼šäººæ°‘å¸(CNY)
   - æ•°æ®æºï¼šç»Ÿä¸€ä¸­å›½è‚¡ç¥¨æ¥å£

2. **é¦™æ¸¯è‚¡å¸‚**
   - è‚¡ç¥¨ä»£ç æ ¼å¼ï¼š0700.HK, 00700ç­‰
   - è´§å¸å•ä½ï¼šæ¸¯å¸(HKD)
   - æ•°æ®æºï¼šæ”¹è¿›çš„æ¸¯è‚¡å·¥å…·

3. **ç¾å›½è‚¡å¸‚**
   - è‚¡ç¥¨ä»£ç æ ¼å¼ï¼šAAPL, TSLAç­‰
   - è´§å¸å•ä½ï¼šç¾å…ƒ(USD)
   - æ•°æ®æºï¼šFinnHub, Yahoo Financeç­‰

## åˆ†ææµç¨‹

### 1. æ•°æ®è·å–é˜¶æ®µ
```mermaid
graph LR
    A[è‚¡ç¥¨ä»£ç ] --> B[å¸‚åœºç±»å‹è¯†åˆ«]
    B --> C[é€‰æ‹©æ•°æ®æº]
    C --> D[è·å–åŸå§‹æ•°æ®]
    D --> E[æ•°æ®é¢„å¤„ç†]
```

### 2. åˆ†ææ‰§è¡Œé˜¶æ®µ
```mermaid
graph TB
    A[åŸå§‹æ•°æ®] --> B[åŸºæœ¬é¢åˆ†æå¸ˆ]
    A --> C[å¸‚åœºåˆ†æå¸ˆ]
    A --> D[æ–°é—»åˆ†æå¸ˆ]
    A --> E[ç¤¾äº¤åª’ä½“åˆ†æå¸ˆ]
    
    B --> F[åŸºæœ¬é¢æŠ¥å‘Š]
    C --> G[å¸‚åœºåˆ†ææŠ¥å‘Š]
    D --> H[æ–°é—»åˆ†ææŠ¥å‘Š]
    E --> I[æƒ…ç»ªåˆ†ææŠ¥å‘Š]
```

### 3. æŠ¥å‘Šç”Ÿæˆé˜¶æ®µ
```mermaid
graph LR
    A[å„åˆ†æå¸ˆæŠ¥å‘Š] --> B[çŠ¶æ€æ›´æ–°]
    B --> C[ä¼ é€’ç»™ç ”ç©¶å‘˜å›¢é˜Ÿ]
    C --> D[è¿›å…¥è¾©è®ºé˜¶æ®µ]
```

## é…ç½®é€‰é¡¹

### åˆ†æå¸ˆé€‰æ‹©
```python
# å¯é€‰æ‹©çš„åˆ†æå¸ˆç±»å‹
selected_analysts = [
    "market",        # å¸‚åœºåˆ†æå¸ˆ
    "social",        # ç¤¾äº¤åª’ä½“åˆ†æå¸ˆ
    "news",          # æ–°é—»åˆ†æå¸ˆ
    "fundamentals"   # åŸºæœ¬é¢åˆ†æå¸ˆ
]
```

### å·¥å…·é…ç½®
```python
toolkit_config = {
    "online_tools": True,     # æ˜¯å¦ä½¿ç”¨åœ¨çº¿å·¥å…·
    "cache_enabled": True,    # æ˜¯å¦å¯ç”¨ç¼“å­˜
    "timeout": 30,           # APIè¶…æ—¶æ—¶é—´
    "retry_count": 3         # é‡è¯•æ¬¡æ•°
}
```

## æ—¥å¿—å’Œç›‘æ§

### ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ
```python
# æ¯ä¸ªåˆ†æå¸ˆéƒ½ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—ç³»ç»Ÿ
logger = get_logger("default")

# è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
logger.debug(f"ğŸ“Š [DEBUG] åŸºæœ¬é¢åˆ†æå¸ˆèŠ‚ç‚¹å¼€å§‹")
logger.info(f"ğŸ“Š [åŸºæœ¬é¢åˆ†æå¸ˆ] æ­£åœ¨åˆ†æè‚¡ç¥¨: {ticker}")
logger.warning(f"âš ï¸ [DEBUG] memoryä¸ºNoneï¼Œè·³è¿‡å†å²è®°å¿†æ£€ç´¢")
```

### æ€§èƒ½ç›‘æ§
- åˆ†æè€—æ—¶ç»Ÿè®¡
- APIè°ƒç”¨æ¬¡æ•°è¿½è¸ª
- é”™è¯¯ç‡ç›‘æ§
- ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„åˆ†æå¸ˆ

1. **åˆ›å»ºåˆ†æå¸ˆæ–‡ä»¶**
```python
# tradingagents/agents/analysts/custom_analyst.py
from tradingagents.utils.tool_logging import log_analyst_module
from tradingagents.utils.logging_init import get_logger

def create_custom_analyst(llm, toolkit):
    @log_analyst_module("custom")
    def custom_analyst_node(state):
        # è‡ªå®šä¹‰åˆ†æé€»è¾‘
        pass
    return custom_analyst_node
```

2. **æ³¨å†Œåˆ°ç³»ç»Ÿ**
```python
# åœ¨trading_graph.pyä¸­æ·»åŠ 
selected_analysts.append("custom")
```

### æ·»åŠ æ–°çš„æ•°æ®æº

1. **å®ç°æ•°æ®æ¥å£**
2. **æ·»åŠ åˆ°å·¥å…·é›†**
3. **æ›´æ–°é…ç½®é€‰é¡¹**

## æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†
- ä½¿ç”¨try-catchåŒ…è£…APIè°ƒç”¨
- æä¾›é™çº§æ–¹æ¡ˆ
- è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯

### 2. æ€§èƒ½ä¼˜åŒ–
- å¯ç”¨æ•°æ®ç¼“å­˜
- åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
- é¿å…é‡å¤APIè°ƒç”¨

### 3. æ•°æ®è´¨é‡
- éªŒè¯æ•°æ®å®Œæ•´æ€§
- å¤„ç†å¼‚å¸¸å€¼
- æä¾›æ•°æ®è´¨é‡è¯„åˆ†

### 4. å¯ç»´æŠ¤æ€§
- ä½¿ç”¨ç»Ÿä¸€çš„ä»£ç ç»“æ„
- æ·»åŠ è¯¦ç»†çš„æ³¨é‡Š
- éµå¾ªå‘½åè§„èŒƒ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **APIè°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - éªŒè¯APIå¯†é’¥
   - æŸ¥çœ‹é€Ÿç‡é™åˆ¶

2. **æ•°æ®æ ¼å¼é”™è¯¯**
   - æ£€æŸ¥è‚¡ç¥¨ä»£ç æ ¼å¼
   - éªŒè¯å¸‚åœºç±»å‹è¯†åˆ«
   - æŸ¥çœ‹æ•°æ®æºå…¼å®¹æ€§

3. **æ€§èƒ½é—®é¢˜**
   - å¯ç”¨ç¼“å­˜æœºåˆ¶
   - ä¼˜åŒ–å¹¶å‘è®¾ç½®
   - å‡å°‘ä¸å¿…è¦çš„APIè°ƒç”¨

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
```python
logger.setLevel(logging.DEBUG)
```

2. **æ£€æŸ¥çŠ¶æ€ä¼ é€’**
```python
logger.debug(f"å½“å‰çŠ¶æ€: {state}")
```

3. **éªŒè¯å·¥å…·é…ç½®**
```python
logger.debug(f"å·¥å…·é…ç½®: {toolkit.config}")
```

åˆ†æå¸ˆå›¢é˜Ÿæ˜¯æ•´ä¸ªTradingAgentsæ¡†æ¶çš„åŸºç¡€ï¼Œé€šè¿‡ä¸“ä¸šåŒ–åˆ†å·¥å’Œåä½œï¼Œä¸ºåç»­çš„ç ”ç©¶è¾©è®ºå’Œäº¤æ˜“å†³ç­–æä¾›é«˜è´¨é‡çš„æ•°æ®æ”¯æŒã€‚